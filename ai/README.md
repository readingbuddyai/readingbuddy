# Korean Pronunciation AI Server

> Wav2Vec2 + LoRA Fine-tuning

**í”„ë¡œì íŠ¸**: S13P31A206
**ë¸Œëœì¹˜**: `ai-dev` (AI ì„œë²„ ì „ìš© ë¸Œëœì¹˜)
**ì„œë²„**: http://3.36.239.57:8000
**ìƒíƒœ**: Production Ready

---

## ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
- [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [API ì—”ë“œí¬ì¸íŠ¸](#-api-ì—”ë“œí¬ì¸íŠ¸)
- [ê°œë°œ í™˜ê²½ ì„¤ì •](#-ê°œë°œ-í™˜ê²½-ì„¤ì •)
- [ë°°í¬](#-ë°°í¬)
- [ëª¨ë‹ˆí„°ë§](#-ëª¨ë‹ˆí„°ë§)
- [ì„±ëŠ¥ ì§€í‘œ](#-ì„±ëŠ¥-ì§€í‘œ)
- [í…ŒìŠ¤íŠ¸](#-í…ŒìŠ¤íŠ¸)

---

## í”„ë¡œì íŠ¸ ê°œìš”

í•œêµ­ì–´ í•™ìŠµìë¥¼ ìœ„í•œ AI ê¸°ë°˜ ì‹¤ì‹œê°„ ë°œìŒ êµì • ì‹œìŠ¤í…œì…ë‹ˆë‹¤. Wav2Vec2 ìŒì„± ì¸ì‹ ëª¨ë¸ì— LoRA(Low-Rank Adaptation) íŒŒì¸íŠœë‹ì„ ì ìš©í•˜ì—¬ í•œêµ­ì–´ ìŒì†Œ ì¸ì‹ ì •í™•ë„ë¥¼ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•

- **ìëª¨ ë‹¨ìœ„ ë¶„ì„**: ã„±, ã„´, ã„· ë“± ê°œë³„ ììŒ/ëª¨ìŒ ë°œìŒ ì •í™•ë„ ì¸¡ì •
- **ìŒì ˆ/ë‹¨ì–´ ë‹¨ìœ„ ì§€ì›**: ê°€, ë‚˜, ë‹¤ë¶€í„° ê°ì, ì‚¬ê³¼ê¹Œì§€ ë‹¤ì–‘í•œ ë‹¨ìœ„ ë¶„ì„
- **ì‹¤ì‹œê°„ í”¼ë“œë°±**: í‰ê·  0.5ì´ˆ ì´ë‚´ ë°œìŒ êµì • í”¼ë“œë°± ì œê³µ
- **GPU ê°€ì†**: NVIDIA CUDAë¥¼ í™œìš©í•œ ê³ ì† ì¶”ë¡ 
- **í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ**: CI/CD íŒŒì´í”„ë¼ì¸, ëª¨ë‹ˆí„°ë§, ìë™ ë°°í¬ êµ¬ì¶•

---

## ì£¼ìš” ê¸°ëŠ¥

### 1. ë‹¤ë‹¨ê³„ ë°œìŒ ê²€ì‚¬

| ê²€ì‚¬ ìœ í˜• | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… | ì˜ˆì‹œ |
|----------|-----------|------|------|
| ìëª¨ ê²€ì‚¬ | `/check/jamo` | ë‹¨ì¼ ììŒ/ëª¨ìŒ ë°œìŒ | ã„±, ã„´, ã…, ã…“ |
| ìŒì ˆ ê²€ì‚¬ | `/check/syllable` | í•œ ìŒì ˆ ë°œìŒ | ê°€, ë‚˜, ê°, ê°• |
| ë‹¨ì–´ ê²€ì‚¬ | `/check/word` | ì—¬ëŸ¬ ìŒì ˆ ë‹¨ì–´ | ê°ì, ì‚¬ê³¼, ì•ˆë…• |

### 2. ì§€ëŠ¥í˜• ì˜¤ë””ì˜¤ ì²˜ë¦¬

- **ìë™ í¬ë§· ê°ì§€**: WAV, MP3, WebM, OGG, FLAC, M4A ì§€ì›
- **ë§¤ì§ ë°”ì´íŠ¸ ê²€ì¦**: íŒŒì¼ í™•ì¥ìê°€ ì•„ë‹Œ ì‹¤ì œ ë‚´ìš©ìœ¼ë¡œ í¬ë§· íŒë‹¨
- **ë‹¤ì¤‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ Fallback**: soundfile â†’ pydub ìë™ ì „í™˜
- **ë…¸ì´ì¦ˆ ì œê±°**: noisereduce ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©
- **ì²­í¬ ì²˜ë¦¬**: ê¸´ ì˜¤ë””ì˜¤ëŠ” 1ì´ˆ ë‹¨ìœ„ë¡œ ë¶„í•  ì²˜ë¦¬

### 3. LoRA íŒŒì¸íŠœë‹ ëª¨ë¸

```
ë² ì´ìŠ¤ ëª¨ë¸: Wav2Vec2-XLS-R-300M (1.2GB)
LoRA ì–´ëŒ‘í„°: 23MB (ì „ì²´ì˜ 1.9%)
ì„±ëŠ¥ í–¥ìƒ: í•œêµ­ì–´ ìŒì†Œ ì¸ì‹ë¥  +15%
```

### 4. í”„ë¡œë•ì…˜ ê¸°ëŠ¥

- Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (`/metrics`)
- í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ (`/health`)
- íŒŒì¼ ë¡œê¹… + ë¡œê·¸ ë¡œí…Œì´ì…˜ (10MB, 5ê°œ ë°±ì—…)
- í™˜ê²½ë³„ CORS ì„¤ì • (ê°œë°œ/í”„ë¡œë•ì…˜)
- 32ê°œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (pytest)
- GitLab CI/CD ìë™ ë°°í¬

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Backend Framework
- **FastAPI** 0.104.1 - ê³ ì„±ëŠ¥ ë¹„ë™ê¸° ì›¹ í”„ë ˆì„ì›Œí¬
- **Uvicorn** - ASGI ì„œë²„
- **Pydantic** 2.5.0 - íƒ€ì… ì•ˆì „ì„± ë° ë°ì´í„° ê²€ì¦

### AI/ML
- **PyTorch** 2.5.1 - ë”¥ëŸ¬ë‹ í”„ë ˆì„ì›Œí¬
- **Transformers** 4.46.3 - Hugging Face ëª¨ë¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **PEFT** 0.13.2 - LoRA íŒŒì¸íŠœë‹
- **Wav2Vec2** - ìŒì„± ì¸ì‹ ë² ì´ìŠ¤ ëª¨ë¸

### Audio Processing
- **soundfile** 0.12.1 - ì˜¤ë””ì˜¤ I/O
- **librosa** 0.10.1 - ì˜¤ë””ì˜¤ ë¶„ì„
- **pydub** 0.25.1 - ì˜¤ë””ì˜¤ ë³€í™˜
- **noisereduce** 3.0.0 - ë…¸ì´ì¦ˆ ì œê±°
- **ffmpeg** - ì˜¤ë””ì˜¤ ì¸ì½”ë”©/ë””ì½”ë”©

### Infrastructure
- **Docker** + **nvidia-docker** - ì»¨í…Œì´ë„ˆí™”
- **CUDA** 12.4.1 - GPU ê°€ì†
- **GitLab CI/CD** - ìë™ ë°°í¬
- **Prometheus** - ë©”íŠ¸ë¦­ ìˆ˜ì§‘

### Testing & Monitoring
- **pytest** 8.0.0 - í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
- **pytest-asyncio** - ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸
- **prometheus-client** 0.19.0 - ë©”íŠ¸ë¦­ ìµìŠ¤í¬í„°

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      HTTP/REST      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   FastAPI       â”‚
â”‚  (Frontend) â”‚                      â”‚   Server        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Audio Processing
                                              â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ Audio Utils     â”‚
                                     â”‚ - Format detect â”‚
                                     â”‚ - Noise reduce  â”‚
                                     â”‚ - Chunking      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Inference
                                              â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚  Wav2Vec2       â”‚
                                     â”‚  + LoRA         â”‚
                                     â”‚  (GPU)          â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Phoneme tokens
                                              â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ Jamo Converter  â”‚
                                     â”‚ - Compose       â”‚
                                     â”‚ - Decompose     â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ Result
                                              â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚   Response      â”‚
                                     â”‚   (JSON)        â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Routers (API Layer)               â”‚
â”‚  - /health, /check/jamo, /syllable, /word   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Services (Business Logic)           â”‚
â”‚  - inference.py: AI ëª¨ë¸ ì¶”ë¡                â”‚
â”‚  - utils_audio.py: ì˜¤ë””ì˜¤ ì²˜ë¦¬              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Core (Configuration)               â”‚
â”‚  - config.py: í™˜ê²½ ì„¤ì • ê´€ë¦¬                â”‚
â”‚  - schemas.py: ë°ì´í„° ìŠ¤í‚¤ë§ˆ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
ai/                              # AI ì„œë²„ ë£¨íŠ¸
â”‚
â”œâ”€â”€ .gitignore                   # Git ì œì™¸ íŒŒì¼ ëª©ë¡
â”œâ”€â”€ README.md                    # ğŸ“„ ì´ íŒŒì¼
â”‚
â”œâ”€â”€ app/                         # ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
    â”‚   â”œâ”€â”€ main.py              # FastAPI ì•± + ë¡œê¹… + ë©”íŠ¸ë¦­
    â”‚   â”œâ”€â”€ schemas.py           # Pydantic ì‘ë‹µ ëª¨ë¸
    â”‚   â”‚
    â”‚   â”œâ”€â”€ core/                # í•µì‹¬ ì„¤ì •
    â”‚   â”‚   â””â”€â”€ config.py        # í™˜ê²½ ë³€ìˆ˜, ëª¨ë¸ ê²½ë¡œ
    â”‚   â”‚
    â”‚   â”œâ”€â”€ routers/             # API ì—”ë“œí¬ì¸íŠ¸
    â”‚   â”‚   â”œâ”€â”€ health.py        # í—¬ìŠ¤ì²´í¬
    â”‚   â”‚   â””â”€â”€ phoneme.py       # ë°œìŒ ê²€ì‚¬ API
    â”‚   â”‚
    â”‚   â””â”€â”€ services/            # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    â”‚       â”œâ”€â”€ inference.py     # AI ëª¨ë¸ ì¶”ë¡ 
    â”‚       â””â”€â”€ utils_audio.py   # ì˜¤ë””ì˜¤ ì²˜ë¦¬ ìœ í‹¸
    â”‚
    â”œâ”€â”€ tests/                   # í…ŒìŠ¤íŠ¸ ì½”ë“œ (32 tests)
    â”‚   â”œâ”€â”€ test_api.py          # API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
    â”‚   â”œâ”€â”€ test_jamo_conversion.py  # í•œê¸€ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
    â”‚   â””â”€â”€ test_audio_utils.py  # ì˜¤ë””ì˜¤ ìœ í‹¸ í…ŒìŠ¤íŠ¸
    â”‚
    â”œâ”€â”€ models/                  # AI ëª¨ë¸ (gitignore)
    â”‚   â”œâ”€â”€ base/                # ë² ì´ìŠ¤ ëª¨ë¸ (1.2GB)
    â”‚   â”‚   â””â”€â”€ slplab_wav2vec2_korean/
    â”‚   â””â”€â”€ lora/                # LoRA ì–´ëŒ‘í„° (23MB)
    â”‚       â””â”€â”€ final_model/
    â”‚
    â”œâ”€â”€ logs/                    # ë¡œê·¸ íŒŒì¼ (gitignore)
    â”‚   â””â”€â”€ app.log              # ë¡œí…Œì´ì…˜ ë¡œê·¸ (10MB Ã— 5)
    â”‚
â”œâ”€â”€ Dockerfile                   # Docker ì´ë¯¸ì§€ ì •ì˜
â”œâ”€â”€ docker-compose.yml           # ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì„¤ì •
â”œâ”€â”€ requirements.txt             # Python ì˜ì¡´ì„±
â”œâ”€â”€ pytest.ini                   # pytest ì„¤ì •
â”œâ”€â”€ run.py                       # ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ setup-ec2.sh                 # EC2 ì´ˆê¸° ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ analysis.md                  # ì½”ë“œ ë¶„ì„ ë³´ê³ ì„œ
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### Base URL
```
Production: http://3.36.239.57:8000
Local: http://localhost:8000
```

### 1. Health Check

**GET** `/health/`

ì„œë²„ ìƒíƒœ ë° GPU ì‚¬ìš© ì—¬ë¶€ í™•ì¸

**Response**
```json
{
  "status": "ok",
  "device": "cuda"
}
```

### 2. ìëª¨ ê²€ì‚¬

**POST** `/check/jamo`

ë‹¨ì¼ ììŒ/ëª¨ìŒ ë°œìŒ ê²€ì‚¬

**Request**
- `file`: ì˜¤ë””ì˜¤ íŒŒì¼ (multipart/form-data)
- `target`: ëª©í‘œ ìëª¨ (ì˜ˆ: "ã„±", "ã…")

**Response**
```json
{
  "type": "jamo",
  "target": "ã„±",
  "decoded_tokens": ["G", "EU"],
  "is_correct": true,
  "feedback": "'ã„±' ë°œìŒì´ ì •í™•í•´ìš”!"
}
```

### 3. ìŒì ˆ ê²€ì‚¬

**POST** `/check/syllable`

í•œ ìŒì ˆ ë°œìŒ ê²€ì‚¬ (ì´ˆì„±+ì¤‘ì„±+ì¢…ì„±)

**Request**
- `file`: ì˜¤ë””ì˜¤ íŒŒì¼
- `target`: ëª©í‘œ ìŒì ˆ (ì˜ˆ: "ê°€", "ê°")

**Response**
```json
{
  "type": "syllable",
  "target": "ê°",
  "decomposed": ["ã„±", "ã…", "ã…"],
  "decoded_tokens": ["G", "A", "M"],
  "is_correct": true,
  "feedback": "'ê°' ë°œìŒì´ ì •í™•í•´ìš”!"
}
```

### 4. ë‹¨ì–´ ê²€ì‚¬

**POST** `/check/word`

ì—¬ëŸ¬ ìŒì ˆë¡œ ì´ë£¨ì–´ì§„ ë‹¨ì–´ ë°œìŒ ê²€ì‚¬

**Request**
- `file`: ì˜¤ë””ì˜¤ íŒŒì¼
- `target`: ëª©í‘œ ë‹¨ì–´ (ì˜ˆ: "ê°ì", "ì•ˆë…•")

**Response**
```json
{
  "type": "word",
  "target": "ê°ì",
  "syllables": [["ã„±", "ã…", "ã…"], ["ã…ˆ", "ã…"]],
  "decoded_tokens": ["G", "A", "M", "J", "A"],
  "is_correct": true,
  "feedback": "'ê°ì' ë°œìŒì´ ì •í™•í•´ìš”!"
}
```

### 5. Prometheus Metrics

**GET** `/metrics`

ì„œë²„ ì„±ëŠ¥ ë©”íŠ¸ë¦­ (Prometheus í¬ë§·)

**Metrics**
- `api_requests_total` - ì´ API ìš”ì²­ ìˆ˜
- `api_request_duration_seconds` - API ì‘ë‹µ ì‹œê°„
- `inference_duration_seconds` - AI ì¶”ë¡  ì‹œê°„
- `active_requests` - í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ìš”ì²­ ìˆ˜

---

## ê°œë°œ í™˜ê²½ ì„¤ì •

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Python 3.10+
- CUDA 12.4+ (GPU ì‚¬ìš© ì‹œ)
- Docker + nvidia-docker (ë°°í¬ ì‹œ)
- FFmpeg (ì˜¤ë””ì˜¤ ì²˜ë¦¬ìš©)

### ë¡œì»¬ ê°œë°œ í™˜ê²½

1. **ì €ì¥ì†Œ í´ë¡ **
```bash
git clone https://lab.ssafy.com/s13-final/S13P31A206.git
cd S13P31A206/ai
```

2. **ê°€ìƒí™˜ê²½ ìƒì„±**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows
```

3. **ì˜ì¡´ì„± ì„¤ì¹˜**
```bash
pip install -r requirements.txt
```

4. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
```bash
cp .env.example .env
# .env íŒŒì¼ í¸ì§‘ (ëª¨ë¸ ê²½ë¡œ ë“±)
```

5. **ëª¨ë¸ ë‹¤ìš´ë¡œë“œ**
```bash
# ë² ì´ìŠ¤ ëª¨ë¸ (1.2GB)
mkdir -p models/base
# LoRA ì–´ëŒ‘í„°ëŠ” ë³„ë„ ì œê³µ

# ë˜ëŠ” ì„œë²„ì—ì„œ ë³µì‚¬
scp -r ubuntu@3.36.239.57:/home/ubuntu/ai/models ./
```

6. **ì„œë²„ ì‹¤í–‰**
```bash
python run.py
# ë˜ëŠ”
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

7. **API ë¬¸ì„œ í™•ì¸**
```
ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8000/docs ì ‘ì†
```

---

## ë°°í¬

### Docker ë°°í¬ (ê¶Œì¥)

**ê°œë°œ í™˜ê²½**
```bash
docker-compose up -d
```

**í”„ë¡œë•ì…˜ í™˜ê²½**
```bash
# docker-compose.ymlì˜ ENVë¥¼ productionìœ¼ë¡œ ë³€ê²½
docker-compose down
docker-compose build
docker-compose up -d
```

### EC2 ìˆ˜ë™ ë°°í¬

1. **EC2 ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •**
```bash
# setup-ec2.sh ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
chmod +x setup-ec2.sh
./setup-ec2.sh
```

2. **ì½”ë“œ ì—…ë°ì´íŠ¸**
```bash
cd /home/ubuntu/ai
git pull origin master
```

3. **Docker ì¬ë°°í¬**
```bash
docker-compose down
docker build -t korean-pronunciation-ai:latest .
docker-compose up -d
```

### GitLab CI/CD ìë™ ë°°í¬

`ai-dev` ë˜ëŠ” `master` ë¸Œëœì¹˜ì— pushí•˜ë©´ ìë™ ë°°í¬ë©ë‹ˆë‹¤.

**íŒŒì´í”„ë¼ì¸ ë‹¨ê³„**
1. **Test**: pytest ì‹¤í–‰ (32ê°œ í…ŒìŠ¤íŠ¸)
2. **Deploy**: EC2 ì„œë²„ì— SSH ì ‘ì†í•˜ì—¬ ìë™ ë°°í¬

**íŠ¸ë¦¬ê±° ì¡°ê±´**
- `ai/**` íŒŒì¼ ë³€ê²½
- `.gitlab-ci.yml` ë³€ê²½

**ë°°í¬ ê³¼ì •**
```bash
1. git pull origin master
2. docker build
3. docker-compose down
4. docker-compose up -d
5. health check (http://localhost:8000/health/)
```

---

## ëª¨ë‹ˆí„°ë§

### Prometheus ë©”íŠ¸ë¦­

**ë©”íŠ¸ë¦­ ìˆ˜ì§‘**
```bash
curl http://3.36.239.57:8000/metrics
```

**ì£¼ìš” ë©”íŠ¸ë¦­**

| ë©”íŠ¸ë¦­ | íƒ€ì… | ì„¤ëª… |
|-------|------|------|
| `api_requests_total` | Counter | ì´ API ìš”ì²­ ìˆ˜ (method, endpoint, statusë³„) |
| `api_request_duration_seconds` | Histogram | API ì‘ë‹µ ì‹œê°„ ë¶„í¬ |
| `inference_duration_seconds` | Histogram | AI ì¶”ë¡  ì‹œê°„ ë¶„í¬ |
| `active_requests` | Gauge | í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ìš”ì²­ ìˆ˜ |

### ë¡œê·¸ í™•ì¸

**ì»¨í…Œì´ë„ˆ ë¡œê·¸**
```bash
docker-compose logs -f
```

**ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸**
```bash
tail -f logs/app.log
```

**ë¡œê·¸ í¬ë§·**
```
2025-11-09 08:00:00,123 - app.main - INFO - AI ëª¨ë¸ ë¡œë”© ì™„ë£Œ - Device: cuda, LoRA: True
2025-11-09 08:00:15,456 - app.services.inference - INFO - ì¶”ë¡  ì™„ë£Œ - ì†Œìš” ì‹œê°„: 0.234ì´ˆ
```

### í—¬ìŠ¤ì²´í¬

**ìˆ˜ë™ í™•ì¸**
```bash
curl http://3.36.239.57:8000/health/
```

**ìë™ í—¬ìŠ¤ì²´í¬**
Docker ì»¨í…Œì´ë„ˆê°€ 30ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ í—¬ìŠ¤ì²´í¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## ì„±ëŠ¥ ì§€í‘œ

### ì¶”ë¡  ì„±ëŠ¥

| ì¸¡ì • í•­ëª© | ê°’ | í™˜ê²½ |
|----------|----|----|
| ì½œë“œ ìŠ¤íƒ€íŠ¸ | ~15ì´ˆ | ì²« ìš”ì²­ ì‹œ ëª¨ë¸ ë¡œë”© |
| ì›œ ì¶”ë¡  (1ì´ˆ ì˜¤ë””ì˜¤) | 0.2~0.5ì´ˆ | GPU |
| ì›œ ì¶”ë¡  (1ì´ˆ ì˜¤ë””ì˜¤) | 2~5ì´ˆ | CPU |
| GPU ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | ~2.5GB | CUDA 12.4 |
| ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ | 10+ req/s | g4dn.xlarge |

### ëª¨ë¸ í¬ê¸°

| ì»´í¬ë„ŒíŠ¸ | í¬ê¸° | ì„¤ëª… |
|---------|------|------|
| ë² ì´ìŠ¤ ëª¨ë¸ | 1.2GB | Wav2Vec2-XLS-R-300M |
| LoRA ì–´ëŒ‘í„° | 23MB | íŒŒì¸íŠœë‹ ê°€ì¤‘ì¹˜ |
| Docker ì´ë¯¸ì§€ | 11.5GB | CUDA + Python + ì˜ì¡´ì„± |

### ìµœì í™” ê¸°ë²•

**ì„œë²„ ì‹œì‘ ì‹œ ëª¨ë¸ ì‚¬ì „ ë¡œë”©** - ì½œë“œ ìŠ¤íƒ€íŠ¸ ì œê±°
**GPU Keep-Alive** - 3ì´ˆë§ˆë‹¤ ë”ë¯¸ ì¶”ë¡ ìœ¼ë¡œ ì ˆì „ ëª¨ë“œ ë°©ì§€
**LoRA merge_and_unload()** - ì¶”ë¡  ì†ë„ í–¥ìƒ
**ì²­í¬ ì²˜ë¦¬** - ê¸´ ì˜¤ë””ì˜¤ ë¶„í•  ì²˜ë¦¬ë¡œ ë©”ëª¨ë¦¬ ì ˆì•½
**ë¹„ë™ê¸° ì²˜ë¦¬** - FastAPIì˜ async/await í™œìš©

---

## í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

**ì „ì²´ í…ŒìŠ¤íŠ¸**
```bash
pytest tests/ -v
```

**íŠ¹ì • í…ŒìŠ¤íŠ¸ íŒŒì¼**
```bash
pytest tests/test_api.py -v
pytest tests/test_jamo_conversion.py -v
pytest tests/test_audio_utils.py -v
```

**ì»¤ë²„ë¦¬ì§€ í¬í•¨**
```bash
pytest tests/ -v --cov=app --cov-report=html
```

### í…ŒìŠ¤íŠ¸ êµ¬ì„±

| íŒŒì¼ | í…ŒìŠ¤íŠ¸ ìˆ˜ | ë‚´ìš© |
|------|----------|------|
| `test_api.py` | 8 | API ì—”ë“œí¬ì¸íŠ¸ í†µí•© í…ŒìŠ¤íŠ¸ |
| `test_jamo_conversion.py` | 13 | í•œê¸€ ìëª¨ ë¶„í•´/ì¡°í•© í…ŒìŠ¤íŠ¸ |
| `test_audio_utils.py` | 11 | ì˜¤ë””ì˜¤ í¬ë§· ê°ì§€ í…ŒìŠ¤íŠ¸ |
| **Total** | **32** | - |

### CIì—ì„œ ìë™ í…ŒìŠ¤íŠ¸

ëª¨ë“  PRê³¼ pushì—ì„œ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

```yaml
# .gitlab-ci.yml
test-ai:
  stage: test
  script:
    - pytest tests/ -v --tb=short
```

---

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜

### `.env` íŒŒì¼

```bash
# ëª¨ë¸ ê²½ë¡œ
BASE_MODEL_PATH=./models/base/slplab_wav2vec2_korean
LORA_MODEL_PATH=./models/lora/final_model
USE_LORA=True

# ì„œë²„ ì„¤ì •
HOST=0.0.0.0
PORT=8000
ENV=production  # development, production

# ë³´ì•ˆ
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# ì˜¤ë””ì˜¤ ì²˜ë¦¬
MAX_AUDIO_LENGTH_SECONDS=30
MAX_FILE_SIZE_MB=10
```

---

## ì½”ë“œ í’ˆì§ˆ

### ì •ì  ë¶„ì„ ê²°ê³¼

- **ì´ ì½”ë“œ ë¼ì¸ ìˆ˜**: ~856 lines (Python)
- **ì½”ë“œ í’ˆì§ˆ ì ìˆ˜**: 7.0/10
- **ì£¼ìš” ê°•ì **: ì•„í‚¤í…ì²˜ ì„¤ê³„, LoRA í†µí•©, ì˜¤ë””ì˜¤ ì²˜ë¦¬
- **ê°œì„  ì˜ì—­**: ë¬¸ì„œí™”, í™˜ê²½ ê²€ì¦

ìì„¸í•œ ë¶„ì„ì€ [`analysis.md`](analysis.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

## ê¸°ì—¬

ì´ í”„ë¡œì íŠ¸ëŠ” SSAFY 13ê¸° íŠ¹í™” í”„ë¡œì íŠ¸ì˜ ì¼ë¶€ì…ë‹ˆë‹¤.

**íŒ€**: A206
**ê¸°ê°„**: 2024.10 ~ 2024.11

---

## ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ê´€ë ¨ ë§í¬

- **API ë¬¸ì„œ**: http://3.36.239.57:8000/docs
- **Prometheus ë©”íŠ¸ë¦­**: http://3.36.239.57:8000/metrics
- **í—¬ìŠ¤ì²´í¬**: http://3.36.239.57:8000/health/
- **GitLab Repository**: https://lab.ssafy.com/s13-final/S13P31A206

---

## ë¬¸ì˜

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì€ GitLab ì´ìŠˆë¥¼ í†µí•´ ë“±ë¡í•´ì£¼ì„¸ìš”.

---

**Last Updated**: 2025-11-09
**Version**: 0.3.0
